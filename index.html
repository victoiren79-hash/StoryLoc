<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoryLoc - Legends of Africa</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --gold: #D4AF37;
            --dark-gold: #B8860B;
            --black: #000000;
            --dark-gray: #1A1A1A;
            --light-gray: #333333;
            --text-color: #E5E5E5;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--black);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(to bottom, var(--black), var(--dark-gray));
            padding: 20px 0;
            border-bottom: 3px solid var(--gold);
            position: relative;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 2.2rem;
            color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
            position: relative;
        }
        
        .logo h1::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--gold), transparent);
        }
        
        .tagline {
            font-size: 1.1rem;
            font-style: italic;
            color: var(--gold);
            margin-top: 5px;
        }
        
        /* Main Content Styles */
        .main-content {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 200px);
            padding: 30px 0;
        }
        
        .intro-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .intro-section h2 {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .intro-section p {
            max-width: 800px;
            margin: 0 auto 20px;
            font-size: 1.1rem;
        }
        
        /* Map Section */
        .map-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
        }
        
        .map-container {
            width: 100%;
            max-width: 900px;
            height: 500px;
            background-color: var(--dark-gray);
            border: 3px solid var(--gold);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }
        
        #africaMap {
            width: 100%;
            height: 100%;
            background: var(--dark-gray);
        }
        
        /* Custom Leaflet Styles */
        .leaflet-container {
            background: var(--dark-gray) !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .leaflet-popup-content {
            color: #333;
        }
        
        .leaflet-control-zoom a {
            background-color: var(--dark-gray) !important;
            color: var(--gold) !important;
            border-color: var(--gold) !important;
        }
        
        .leaflet-control-zoom a:hover {
            background-color: var(--light-gray) !important;
        }
        
        .custom-tooltip {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--gold);
            color: var(--gold);
            font-weight: bold;
        }
        
        /* Story Form Section */
        .story-form-section {
            background-color: var(--dark-gray);
            padding: 30px;
            border-radius: 8px;
            border: 2px solid var(--gold);
            margin-bottom: 40px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .story-form-section h2 {
            color: var(--gold);
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--gold);
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            background-color: var(--black);
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            color: var(--text-color);
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .submit-btn {
            background-color: var(--gold);
            color: var(--black);
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: block;
            margin: 0 auto;
        }
        
        .submit-btn:hover {
            background-color: var(--dark-gold);
        }
        
        .submit-btn:disabled {
            background-color: var(--light-gray);
            cursor: not-allowed;
        }
        
        /* Story Display Section */
        .story-display {
            background-color: var(--dark-gray);
            padding: 30px;
            border-radius: 8px;
            border: 2px solid var(--gold);
            margin-bottom: 40px;
            display: none;
        }
        
        .story-display h2 {
            color: var(--gold);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .story-content {
            line-height: 1.8;
            font-size: 1.1rem;
        }
        
        .story-meta {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
            color: var(--gold);
            font-style: italic;
        }
        
        .back-btn {
            background-color: var(--light-gray);
            color: var(--text-color);
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .back-btn:hover {
            background-color: var(--dark-gold);
        }
        
        .stories-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .story-card {
            background-color: var(--black);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--gold);
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .story-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.2);
        }
        
        .story-card h3 {
            color: var(--gold);
            margin-bottom: 10px;
        }
        
        .story-card p {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .add-story-btn {
            background-color: var(--dark-gray);
            color: var(--gold);
            border: 2px dashed var(--gold);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .add-story-btn:hover {
            background-color: rgba(212, 175, 55, 0.1);
            border-style: solid;
        }
        
        .blockchain-badge {
            background: #1A1A1A;
            padding: 12px;
            border: 2px solid #D4AF37;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .blockchain-badge .title {
            color: #D4AF37;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .blockchain-badge .hash {
            font-family: monospace;
            font-size: 0.9rem;
            color: #E5E5E5;
            word-break: break-all;
        }
        
        .blockchain-badge .features {
            font-size: 0.8rem;
            color: #B8860B;
            margin-top: 5px;
        }
        
        .sync-status {
            background: #1A1A1A;
            padding: 10px;
            border: 1px solid #D4AF37;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.9rem;
            color: #D4AF37;
        }
        
        /* Footer Styles */
        footer {
            background-color: var(--dark-gray);
            padding: 30px 0;
            border-top: 3px solid var(--gold);
            text-align: center;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .footer-logo {
            font-size: 1.8rem;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .footer-tagline {
            font-size: 1rem;
            margin-bottom: 20px;
            max-width: 600px;
        }
        
        .social-links {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .social-link {
            color: var(--gold);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .social-link:hover {
            color: var(--dark-gold);
        }
        
        .copyright {
            font-size: 0.9rem;
            color: var(--light-gray);
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .logo {
                margin-bottom: 15px;
            }
            
            .map-container {
                height: 400px;
            }
            
            .intro-section h2 {
                font-size: 1.6rem;
            }
            
            .story-form-section,
            .story-display {
                padding: 20px;
            }
            
            .stories-list {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .logo h1 {
                font-size: 1.8rem;
            }
            
            .map-container {
                height: 300px;
            }
            
            .intro-section h2 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>StoryLoc</h1>
                </div>
                <div class="tagline">
                    Explore the stories that shape a continent
                </div>
            </div>
        </div>
    </header>
    
    <main class="container">
        <section class="main-content">
            <div class="intro-section">
                <h2>Legends of Africa</h2>
                <p>Discover the rich history, culture, and legends of Africa through our interactive map. Each country holds stories of great leaders, epic battles, and cultural heritage.</p>
                <p>Share your own stories and let our AI enhance them with cultural context and historical accuracy.</p>
                <div class="sync-status" id="syncStatus">
                    üîÑ Connecting to StoryLoc Network...
                </div>
            </div>
            
            <div class="map-section">
                <div class="map-container">
                    <div id="africaMap"></div>
                </div>
                <p>Click on any country to explore its stories and legends</p>
            </div>
            
            <div class="story-form-section">
                <h2>Share Your Legend</h2>
                <form id="storyForm">
                    <div class="form-group">
                        <label for="userName">Your Name</label>
                        <input type="text" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Your Email</label>
                        <input type="email" id="userEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="storyCountry">Country of Origin</label>
                        <select id="storyCountry" required>
                            <option value="">Select a country</option>
                            <!-- All African countries will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="storyTitle">Legend Title</label>
                        <input type="text" id="storyTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="userStory">Your Story</label>
                        <textarea id="userStory" placeholder="Tell us your story..." required></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Share Your Legend</button>
                </form>
            </div>
            
            <div class="story-display" id="storyDisplay">
                <!-- Content will be dynamically populated -->
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">StoryLoc</div>
                <p class="footer-tagline">A digital storytelling platform celebrating African history, culture, and legends.</p>
                <div class="social-links">
                    <a href="#" class="social-link">Facebook</a>
                    <a href="#" class="social-link">Twitter</a>
                    <a href="#" class="social-link">Instagram</a>
                </div>
                <p class="copyright">&copy; 2025 StoryLoc. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ==================== CLOUD STORAGE SIMULATION ====================
        class StoryLocCloud {
            constructor() {
                this.storageKey = 'storyloc_cloud_data';
                this.networkNodes = [];
                this.initCloudStorage();
            }

            // Simulate cloud storage using localStorage as a "shared database"
            initCloudStorage() {
                // Create initial cloud data if it doesn't exist
                if (!localStorage.getItem(this.storageKey)) {
                    const initialData = this.getDefaultStories();
                    localStorage.setItem(this.storageKey, JSON.stringify(initialData));
                }
                
                // Simulate network synchronization
                this.simulateNetworkSync();
            }

            getDefaultStories() {
                return {
                    "nigeria": [
                        {
                            title: "The Benin Kingdom",
                            content: "I remember the stories my grandfather told me about the great Benin Kingdom. He said our ancestors built a civilization that amazed even the Europeans when they first arrived. The bronze sculptures they created weren't just art - they were our history, our stories cast in metal for all time. I can almost hear the blacksmiths hammering away, creating those intricate plaques that told of our kings and warriors. The administrative system was so advanced that the kingdom stretched across what is now southern Nigeria, with trade routes connecting us to distant lands. When the British came with their guns, our warriors fought bravely, but the kingdom eventually fell. Still, the spirit of Benin lives on in our people.",
                            author: "StoryLoc Community",
                            date: "2023-01-15",
                            blockchainHash: "0x4b82f8d1c3e9a7f2",
                            upvotes: 15
                        },
                        {
                            title: "Queen Amina of Zazzau",
                            content: "Let me tell you about Queen Amina, the warrior queen who defended our lands. She wasn't just a ruler - she was a military genius who expanded our territory through brilliant campaigns. I've heard tales of how she personally led her warriors into battle, her presence inspiring courage in every soldier. The defensive walls she built around conquered cities still stand in some places, monuments to her vision. As a woman leading in a time when few women held such power, she showed us what was possible. Her legacy isn't just in the territories she conquered, but in the generations of Nigerian women she inspired to be strong and fearless.",
                            author: "StoryLoc Community",
                            date: "2023-05-22",
                            blockchainHash: "0x5c93f9e2d4b8a6f1",
                            upvotes: 12
                        }
                    ],
                    "egypt": [
                        {
                            title: "Cleopatra VII",
                            content: "I've always been fascinated by Cleopatra's story. She wasn't just the last pharaoh of Egypt - she was a master politician who spoke multiple languages and held her own against the rising Roman Empire. I imagine her in the great palace of Alexandria, surrounded by scholars and advisors, making decisions that would determine Egypt's fate. Her alliances with Julius Caesar and Mark Antony weren't just romantic affairs - they were strategic moves to preserve Egyptian independence. When she chose death over humiliation, she became a legend. Her story marks the end of an era, the transition from the Hellenistic Period to Roman Egypt, but her name echoes through history.",
                            author: "StoryLoc Community",
                            date: "2023-03-10",
                            blockchainHash: "0x6a4f7e3d2c9b8a5e",
                            upvotes: 23
                        },
                        {
                            title: "Ramses II - The Great Pharaoh",
                            content: "When I visited Abu Simbel and saw the colossal statues of Ramses II, I felt the weight of history. They say he ruled for 66 years, longer than most of us can even imagine. I think about what it must have been like to live during his reign - the monumental construction projects, the military campaigns that expanded Egyptian influence, the stability he brought to the kingdom. The Ramesseum stands as a testament to his power, but it's the everyday stories that really capture my imagination. What was life like for the workers who built these wonders? For the farmers who fed the kingdom? Ramses wasn't just a pharaoh - he was an era.",
                            author: "StoryLoc Community",
                            date: "2023-09-05",
                            blockchainHash: "0x8c6f9e5d4b3a2f1e",
                            upvotes: 21
                        }
                    ],
                    "south-africa": [
                        {
                            title: "Nelson Mandela - Father of the Nation",
                            content: "I remember the day Nelson Mandela walked out of prison after 27 years. The hope in people's eyes was something I'll never forget. He taught us that forgiveness is stronger than revenge, that unity could heal our divided nation. During his presidency, I saw how he worked to dismantle apartheid's legacy through truth and reconciliation rather than retaliation. His Nobel Peace Prize wasn't just an award - it was recognition that a new way was possible. Even now, when I see his image, I'm reminded that one person's courage can change the course of history. His legacy isn't in monuments or buildings, but in the peace we work to maintain every day.",
                            author: "StoryLoc Community",
                            date: "2023-02-18",
                            blockchainHash: "0xae8b1f7d6c5b4a3e",
                            upvotes: 45
                        }
                    ],
                    "congo": [
                        {
                            title: "Patrice Lumumba - Congo's First Prime Minister",
                            content: "My father used to tell me about Patrice Lumumba, his voice filled with both pride and sadness. He said Lumumba wasn't just a politician - he was the embodiment of Congo's hope for independence. I've read his speeches, and you can feel the passion for a free Africa in every word. His vision went beyond just Congo - he dreamed of a united Africa, free from colonial influence. When he was assassinated, something broke in our people. But his ideas lived on, inspiring liberation movements across the continent. Even today, when I see the challenges our country faces, I remember Lumumba's belief that we could determine our own destiny.",
                            author: "StoryLoc Community",
                            date: "2023-04-15",
                            blockchainHash: "0xcfad3f9e8d7c6b5a",
                            upvotes: 28
                        }
                    ],
                    "libya": [
                        {
                            title: "Muammar Gaddafi - The Brother Leader",
                            content: "I lived through Gaddafi's rule, and it was... complicated. For 42 years, he was the face of Libya, implementing his system of direct democracy called Jamahiriya. I remember the green flags everywhere, the speeches on television that could last for hours. He positioned himself as an anti-imperialist leader, standing up to Western powers. There were good times - education and healthcare improved for many people. But there was also fear, and the knowledge that dissent wasn't tolerated. When the civil war came in 2011, everything changed. Now, years later, I think about how his rule shaped modern Libya, for better and for worse. History will judge him, but we lived through his era.",
                            author: "StoryLoc Community",
                            date: "2023-06-20",
                            blockchainHash: "0xdfbe4faf9e8d7c6b",
                            upvotes: 17
                        }
                    ],
                    "ghana": [
                        {
                            title: "Yaa Asantewaa - Queen Mother of Ejisu",
                            content: "Let me share the story of Yaa Asantewaa that my grandmother passed down to me. When the British demanded the Golden Stool, the sacred symbol of the Ashanti nation, it was Yaa Asantewaa who stood up and said enough. She wasn't a young woman - she was the Queen Mother, a position of wisdom and respect. But when the men hesitated, she took up the fight herself. I can picture her rallying the Ashanti warriors, her voice strong and clear, refusing to let our heritage be stolen. The War of the Golden Stool that followed showed the British that African women could be formidable leaders. Her courage echoes through generations of Ghanaian women.",
                            author: "StoryLoc Community",
                            date: "2023-04-12",
                            blockchainHash: "0xefcf5fbfaf9e8d7c",
                            upvotes: 16
                        }
                    ],
                    "mali": [
                        {
                            title: "Mansa Musa - The Golden King",
                            content: "Have you heard about Mansa Musa's pilgrimage to Mecca? The stories say his caravan stretched as far as the eye could see, with thousands of soldiers, servants, and slaves. But what really captures my imagination is the gold - so much gold that when he passed through Cairo, he gave away so much that he actually caused inflation in the region for years! European maps started showing Mali as a land of incredible wealth after his journey. But Mansa Musa wasn't just wealthy - he built universities and mosques, making Timbuktu a center of learning that attracted scholars from across Africa and the Middle East. His legacy isn't just in the gold, but in the knowledge he valued and preserved.",
                            author: "StoryLoc Community",
                            date: "2023-07-03",
                            blockchainHash: "0x4f2fbfffffffefdf",
                            upvotes: 31
                        }
                    ],
                    "zambia": [
                        {
                            title: "The Legend of Nyaminyami",
                            content: "My people, the Tonga, have told the story of Nyaminyami for generations. They say he's a river god, half fish and half snake, who lives in the Zambezi River. When I was a child, my grandfather would tell me how Nyaminyami protects our people and brings us good fortune. He said that when the river is calm, Nyaminyami is content, but when it rages, he's angry about something. When they built the Kariba Dam and displaced our people, many believed Nyaminyami was separated from his wife, and that's why the floods came. Even now, when I stand by the Zambezi, I feel his presence in the water's flow, a reminder of the old ways and the spirits that watch over us.",
                            author: "StoryLoc Community",
                            date: "2023-10-28",
                            blockchainHash: "0xaf8fffffffffffff",
                            upvotes: 12
                        }
                    ]
                };
            }

            // Get all stories from cloud storage
            getAllStories() {
                const cloudData = localStorage.getItem(this.storageKey);
                return cloudData ? JSON.parse(cloudData) : {};
            }

            // Add story to cloud storage
            addStory(countryId, story) {
                const cloudData = this.getAllStories();
                
                if (!cloudData[countryId]) {
                    cloudData[countryId] = [];
                }
                
                cloudData[countryId].push(story);
                localStorage.setItem(this.storageKey, JSON.stringify(cloudData));
                
                // Simulate propagation to other nodes
                this.simulatePropagation(countryId, story);
                
                return true;
            }

            // Simulate network propagation (for demo purposes)
            simulatePropagation(countryId, story) {
                console.log(`üåê Propagating story to StoryLoc network: "${story.title}" for ${countryId}`);
                
                // Simulate network delay
                setTimeout(() => {
                    document.getElementById('syncStatus').innerHTML = 
                        `‚úÖ Story synchronized across ${Math.floor(Math.random() * 50) + 10} nodes`;
                    
                    setTimeout(() => {
                        document.getElementById('syncStatus').innerHTML = 
                            `üåç Connected to StoryLoc Network | ${Object.keys(this.getAllStories()).length} countries active`;
                    }, 3000);
                }, 1000);
            }

            simulateNetworkSync() {
                // Simulate initial network connection
                setTimeout(() => {
                    document.getElementById('syncStatus').innerHTML = 
                        `üåç Connected to StoryLoc Network | ${Object.keys(this.getAllStories()).length} countries active`;
                }, 2000);
            }
        }

        // ==================== OPTIMIZED BLOCKCHAIN SIMULATION ====================
        class StoryBlockchain {
            constructor() {
                this.chain = this.loadChainFromStorage();
                this.difficulty = 1; // Reduced difficulty for faster mining
            }

            createBlock(story) {
                const previousBlock = this.chain[this.chain.length - 1];
                const previousHash = previousBlock ? previousBlock.hash : '0'.repeat(64);
                
                const block = {
                    index: this.chain.length,
                    timestamp: new Date().toISOString(),
                    story: story,
                    previousHash: previousHash,
                    nonce: 0,
                    hash: ''
                };

                // Use optimized mining
                block.hash = this.fastMineBlock(block);
                return block;
            }

            // OPTIMIZED: Much faster mining algorithm
            fastMineBlock(block) {
                // Use a simpler hash that doesn't require intensive computation
                const data = JSON.stringify(block.story) + block.previousHash + Date.now();
                const hash = this.calculateHash(data);
                
                console.log(`‚õèÔ∏è Fast-mined block #${block.index}`);
                return hash;
            }

            calculateHash(data) {
                let hash = 0;
                for (let i = 0; i < data.length; i++) {
                    const char = data.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return '0x' + Math.abs(hash).toString(16).padStart(16, '0');
            }

            addStory(story) {
                const block = this.createBlock(story);
                this.chain.push(block);
                this.saveChainToStorage();
                
                console.log(`üîó Added to blockchain: Block #${block.index}, Hash: ${block.hash}`);
                return block.hash;
            }

            saveChainToStorage() {
                localStorage.setItem('storyloc_blockchain_chain', JSON.stringify(this.chain));
            }

            loadChainFromStorage() {
                const saved = localStorage.getItem('storyloc_blockchain_chain');
                return saved ? JSON.parse(saved) : [];
            }

            getChainStats() {
                return {
                    length: this.chain.length,
                    totalStories: this.chain.length,
                    networkHash: this.chain.length > 0 ? this.chain[this.chain.length - 1].hash : '0x0'
                };
            }

            validateChain() {
                for (let i = 1; i < this.chain.length; i++) {
                    const currentBlock = this.chain[i];
                    const previousBlock = this.chain[i - 1];
                    
                    if (currentBlock.previousHash !== previousBlock.hash) {
                        return false;
                    }
                }
                return true;
            }
        }

        // ==================== APPLICATION INITIALIZATION ====================
        const storyCloud = new StoryLocCloud();
        const storyBlockchain = new StoryBlockchain();

        // Complete list of all African countries
        const allAfricanCountries = [
            "Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi",
            "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros",
            "Congo", "C√¥te d'Ivoire", "Djibouti", "Egypt", "Equatorial Guinea",
            "Eritrea", "Eswatini", "Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea",
            "Guinea-Bissau", "Kenya", "Lesotho", "Liberia", "Libya", "Madagascar",
            "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique",
            "Namibia", "Niger", "Nigeria", "Rwanda", "S√£o Tom√© and Pr√≠ncipe", "Senegal",
            "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan",
            "Sudan", "Tanzania", "Togo", "Tunisia", "Uganda", "Zambia", "Zimbabwe",
            "Democratic Republic of the Congo"
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            populateCountryDropdown();
            initializeMap();
            
            document.getElementById('storyForm').addEventListener('submit', function(e) {
                e.preventDefault();
                enhanceStory();
            });

            // Show blockchain status
            const stats = storyBlockchain.getChainStats();
            console.log(`üìä Blockchain Status: ${stats.length} blocks, Valid: ${storyBlockchain.validateChain()}`);
        });

        function populateCountryDropdown() {
            const dropdown = document.getElementById('storyCountry');
            allAfricanCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.toLowerCase().replace(/\s+/g, '-');
                option.textContent = country;
                dropdown.appendChild(option);
            });
        }

        function initializeMap() {
            const africaBounds = [[-35, -25], [38, 60]];
            const map = L.map('africaMap', { minZoom: 3, maxBounds: africaBounds }).setView([8, 20], 3);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
                attribution: '¬© CartoDB', noWrap: true, bounds: africaBounds
            }).addTo(map);

            map.setMaxBounds(africaBounds);

            // Load map data and make countries clickable
            fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
                .then(response => response.json())
                .then(worldData => {
                    const africanCountries = {
                        type: "FeatureCollection",
                        features: worldData.features.filter(feature => 
                            allAfricanCountries.includes(feature.properties.name)
                        )
                    };

                    L.geoJSON(africanCountries, {
                        style: { color: '#D4AF37', weight: 1.5, fillColor: '#1A1A1A', fillOpacity: 0.4 },
                        onEachFeature: function(feature, layer) {
                            const countryName = feature.properties.name;
                            const countryId = countryName.toLowerCase().replace(/\s+/g, '-');
                            
                            layer.on('click', function() {
                                displayCountryStories(countryId);
                            });
                            
                            layer.on('mouseover', function() { 
                                this.setStyle({ fillOpacity: 0.7, weight: 2.5 }); 
                            });
                            layer.on('mouseout', function() { 
                                this.setStyle({ fillOpacity: 0.4, weight: 1.5 }); 
                            });
                            layer.bindTooltip(countryName, { permanent: false, className: 'custom-tooltip' });
                        }
                    }).addTo(map);
                })
                .catch(error => {
                    console.error('Error loading map data:', error);
                    document.getElementById('africaMap').innerHTML = `
                        <div style="color: #D4AF37; text-align: center; padding: 50px;">
                            <h3>Map Loading Failed</h3>
                            <p>Please check your internet connection.</p>
                            <p>You can still share and view stories using the form below.</p>
                        </div>
                    `;
                });
        }

        // ==================== OPTIMIZED STORY MANAGEMENT ====================
        function displayCountryStories(countryId) {
            const cloudData = storyCloud.getAllStories();
            const countryStories = cloudData[countryId] || [];
            const countryName = getCountryName(countryId);
            const stats = storyBlockchain.getChainStats();
            
            let storiesHTML = `
                <button class="back-btn" onclick="showMainView()">‚Üê Back to Map</button>
                <h2>Stories from ${countryName}</h2>
                <div class="blockchain-badge">
                    <div class="title">üîó DECENTRALIZED STORY NETWORK</div>
                    <div class="hash">Blockchain: ${stats.length} blocks | ${countryStories.length} stories</div>
                    <div class="features">Immutable ‚Ä¢ Distributed ‚Ä¢ Community-Powered</div>
                </div>
            `;

            if (countryStories.length > 0) {
                storiesHTML += `<p>Community stories from ${countryName}:</p><div class="stories-list">`;
                
                countryStories.forEach((story, index) => {
                    const preview = story.content.substring(0, 120) + '...';
                    storiesHTML += `
                        <div class="story-card" onclick="displayStory('${countryId}', ${index})">
                            <h3>${story.title}</h3>
                            <p>${preview}</p>
                            <p><small>By ${story.author} ‚Ä¢ ${formatDate(story.date)}</small></p>
                            <p style="color: #D4AF37; font-size: 0.8rem;">üîó ${story.blockchainHash} ‚Ä¢ üëç ${story.upvotes || 0}</p>
                        </div>
                    `;
                });
                
                storiesHTML += `</div>`;
            } else {
                storiesHTML += `
                    <p>No stories have been shared for ${countryName} yet.</p>
                    <p>Be the first to share a story from this beautiful country!</p>
                `;
            }

            storiesHTML += `
                <div class="add-story-btn" onclick="scrollToForm()">
                    + Add Your Story About ${countryName}
                </div>
            `;
            
            document.getElementById('storyDisplay').innerHTML = storiesHTML;
            document.getElementById('storyDisplay').style.display = 'block';
            document.getElementById('storyDisplay').scrollIntoView({ behavior: 'smooth' });
        }

        function displayStory(countryId, storyIndex) {
            const cloudData = storyCloud.getAllStories();
            const story = cloudData[countryId][storyIndex];
            const countryName = getCountryName(countryId);
            
            document.getElementById('storyDisplay').innerHTML = `
                <button class="back-btn" onclick="displayCountryStories('${countryId}')">‚Üê Back to Stories</button>
                <h2>${story.title}</h2>
                <div class="blockchain-badge">
                    <div class="title">üîó BLOCKCHAIN VERIFIED</div>
                    <div class="hash">Transaction: ${story.blockchainHash}</div>
                    <div class="features">Immutable ‚Ä¢ Timestamped ‚Ä¢ Decentralized</div>
                </div>
                <div class="story-content">
                    ${story.content}
                </div>
                <div class="story-meta">
                    Shared by ${story.author} on ${formatDate(story.date)} ‚Ä¢ üëç ${story.upvotes || 0} upvotes
                </div>
                <div class="add-story-btn" onclick="scrollToForm()">
                    + Share Your Own Story
                </div>
            `;
            
            document.getElementById('storyDisplay').style.display = 'block';
        }

        // IMPROVED: Better story enhancement - just makes stories longer with storytelling vibe
        function enhanceStory() {
            const userName = document.getElementById('userName').value;
            const userEmail = document.getElementById('userEmail').value;
            const storyCountry = document.getElementById('storyCountry').value;
            const storyTitle = document.getElementById('storyTitle').value;
            const userStory = document.getElementById('userStory').value;
            
            if (!storyCountry) {
                alert('Please select a country for your story.');
                return;
            }
            
            document.querySelector('.submit-btn').textContent = 'Adding Your Story...';
            document.querySelector('.submit-btn').disabled = true;
            document.getElementById('syncStatus').innerHTML = '‚õèÔ∏è Adding your story to the blockchain...';
            
            // OPTIMIZED: Remove the artificial 3-second delay and use faster processing
            setTimeout(() => {
                // IMPROVED: Better story enhancement - just expands the story naturally
                const enhancedStory = enhanceStoryContent(userStory, storyCountry);
                
                // OPTIMIZED: Use the faster blockchain mining
                const blockchainHash = storyBlockchain.addStory({
                    title: storyTitle,
                    author: userName,
                    country: storyCountry,
                    timestamp: new Date().toISOString(),
                    contentPreview: userStory.substring(0, 100) + '...'
                });
                
                // Add to cloud storage
                const newStory = {
                    title: storyTitle,
                    content: enhancedStory,
                    author: userName,
                    date: new Date().toISOString().split('T')[0],
                    blockchainHash: blockchainHash,
                    upvotes: 1
                };
                
                storyCloud.addStory(storyCountry, newStory);
                
                // Show success message
                document.getElementById('storyDisplay').innerHTML = `
                    <button class="back-btn" onclick="showMainView()">‚Üê Back to Map</button>
                    <h2>Your Story is Live! üéâ</h2>
                    <div class="blockchain-badge">
                        <div class="title">üîó SUCCESSFULLY ADDED</div>
                        <div class="hash">Block Hash: ${blockchainHash}</div>
                        <div class="features">Now visible to all StoryLoc users worldwide</div>
                    </div>
                    <div class="story-content">
                        ${enhancedStory}
                    </div>
                    <div class="story-meta">
                        Story enhanced by StoryLoc AI | Shared by ${userName} for ${getCountryName(storyCountry)}
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="submit-btn" onclick="displayCountryStories('${storyCountry}')">See All Stories from ${getCountryName(storyCountry)}</button>
                    </div>
                `;
                document.getElementById('storyDisplay').style.display = 'block';
                
                // Reset form
                document.getElementById('storyForm').reset();
                document.querySelector('.submit-btn').textContent = 'Share Your Legend';
                document.querySelector('.submit-btn').disabled = false;
                
                document.getElementById('storyDisplay').scrollIntoView({ behavior: 'smooth' });
            }, 500); // OPTIMIZED: Reduced from 3000ms to 500ms
        }

        // NEW: Better story enhancement function
        function enhanceStoryContent(originalStory, country) {
            const countryName = getCountryName(country);
            
            // Simple enhancement - just add more descriptive content
            const enhancements = [
                `The memory of that time in ${countryName} stays with me even now.`,
                `I can still picture it clearly in my mind.`,
                `The details come back to me as if it were yesterday.`,
                `There's so much more to this story than what first meets the eye.`,
                `What happened next would change everything.`,
                `The air was thick with anticipation that day.`,
                `Little did we know what was about to unfold.`,
                `The sounds and smells of that place are etched in my memory forever.`,
                `It all began on an ordinary day that would become anything but ordinary.`,
                `Looking back, I realize how significant that moment truly was.`
            ];
            
            // Pick a random enhancement and add it to the story
            const randomEnhancement = enhancements[Math.floor(Math.random() * enhancements.length)];
            
            // Return the enhanced story with natural flow
            return `${originalStory} ${randomEnhancement} I remember how the community came together during those times, sharing stories around the fire and passing down wisdom from our elders. The traditions of ${countryName} run deep in our blood, connecting us to generations who came before. There were challenges, of course - every good story has them - but there was also joy, celebration, and the unbreakable bonds of family and community that sustained us through everything.`;
        }

        function getCountryName(countryId) {
            return allAfricanCountries.find(country => 
                country.toLowerCase().replace(/\s+/g, '-') === countryId
            ) || countryId;
        }

        function showMainView() {
            document.getElementById('storyDisplay').style.display = 'none';
        }

        function scrollToForm() {
            document.getElementById('storyForm').scrollIntoView({ behavior: 'smooth' });
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }
    </script>
</body>
</html>